<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>System Dashboard | AuthProject</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div class="container dashboard-wide">
        <div class="tech-flow">
            <span class="badge">Frontend: HTML/CSS/JS</span>
            <span class="arrow">→</span>
            <span class="badge">Backend: Node/Express</span>
            <span class="arrow">→</span>
            <span class="badge">Database: MongoDB</span>
        </div>

        <header style="margin-bottom: 40px;">
            <h1>Welcome, <span id="welcomeName" style="color:var(--primary)">User</span></h1>
            <p style="color: #64748b;">System status: <span style="color: #10b981; font-weight: bold;">● Live Connection</span></p>
        </header>

        <div class="info-grid">
            <div class="info-card">
                <h3>Frontend</h3>
                <p>Captures user input and sends asynchronous <strong>Fetch API</strong> requests to the server.</p>
            </div>
            <div class="info-card">
                <h3>Backend</h3>
                <p>Processes logic via <strong>Express Routes</strong> and interacts with the database models.</p>
            </div>
            <div class="info-card">
                <h3>Database</h3>
                <p>Persistent storage using <strong>MongoDB</strong>. Data is retrieved as JSON objects.</p>
            </div>
        </div>

        <div class="table-wrapper">
            <div style="padding: 20px; border-bottom: 1px solid #eee; text-align: left;">
                <h2 style="font-size: 18px; margin: 0;">User Directory</h2>
                <small style="color: #94a3b8;">Direct query from <code>db.users.find()</code></small>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Role</th>
                        <th>Age</th>
                    </tr>
                </thead>
                <tbody id="userTableBody"></tbody>
            </table>
        </div>

        <button onclick="logout()" class="logout-btn">Logout from System</button>
    </div>

    <script>
        const name = localStorage.getItem('user_name');
        if (!name) window.location.href = 'login.html';
        document.getElementById('welcomeName').innerText = name;

        async function loadData() {
            const res = await fetch('/api/auth/all-users');
            const users = await res.json();
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = users.map(u => `
                <tr>
                    <td><strong>${u.name}</strong></td>
                    <td>${u.email}</td>
                    <td>${u.phone}</td>
                    <td><span class="role-tag">${u.role}</span></td>
                    <td>${u.age}</td>
                </tr>
            `).join('');
        }

        function logout() {
            localStorage.clear();
            window.location.href = 'login.html';
        }

        loadData();
    </script>
</body>
</html>